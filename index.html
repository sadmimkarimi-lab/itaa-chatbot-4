<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>chatgpt - Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒØªØ§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --green-main: #16a34a;
      --green-main-dark: #15803d;
      --green-soft: #e8f7ee;
      --bg-page: #f6faf7;
      --text-main: #111827;
      --text-muted: #6b7280;
      --bubble-user: #16a34a;
      --bubble-bot: #ffffff;
      --border-soft: #d1fae5;
      --radius-lg: 22px;
      --radius-xl: 26px;
      --shadow-soft: 0 14px 30px rgba(22, 163, 74, 0.18);
      --shadow-chip: 0 6px 15px rgba(22, 163, 74, 0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "IRANSans", "Vazirmatn", Tahoma, sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
    }

    .app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 900px;
      margin: 0 auto;
      background: linear-gradient(145deg, #f9fffb 0%, #effdf6 48%, #e7fbf1 100%);
    }

    /* Header */

    .app-header {
      position: relative;
      background: radial-gradient(circle at top, #22c55e 0, #15803d 55%, #166534 100%);
      color: #ffffff;
      padding: 14px 18px 12px;
      box-shadow: 0 10px 25px rgba(22, 163, 74, 0.45);
      z-index: 2;
    }

    .header-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .header-main {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .bot-avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.75);
      background: radial-gradient(circle at 30% 20%, #fef9c3 0, #f97316 40%, #4ade80 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      overflow: hidden;
    }

    .bot-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .bot-logo-fallback {
      font-size: 22px;
    }

    .header-texts {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .header-title-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.03em;
    }

    .header-title-row span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .header-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
      border: 1px solid rgba(255,255,255,0.35);
      backdrop-filter: blur(4px);
    }

    .header-subtitle {
      font-size: 11px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .online-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #bbf7d0;
      box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.5);
      animation: pulse 1.6s infinite;
    }

    .header-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 11px;
      opacity: 0.92;
    }

    .hint-pill {
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(6, 95, 70, 0.55);
      border: 1px solid rgba(187, 247, 208, 0.4);
    }

    .hint-pill span {
      opacity: 0.95;
    }

    .small-link {
      opacity: 0.85;
    }

    /* Chat layout */

    .chat-shell {
      position: relative;
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 8px 10px 10px;
      overflow: hidden;
    }

    .chat-card {
      position: relative;
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(255,255,255,0.96);
      border-radius: 26px 26px 0 0;
      border: 1px solid #dcfce7;
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .chat-top {
      padding: 8px 14px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-muted);
    }

    .reset-btn {
      background: none;
      border: none;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: #047857;
      background-color: #ecfdf5;
      border: 1px solid #bbf7d0;
      transition: background 0.18s, transform 0.12s, box-shadow 0.18s;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }

    .reset-btn:hover {
      background: #bbf7d0;
      transform: translateY(-1px);
      box-shadow: 0 6px 12px rgba(22, 163, 74, 0.22);
    }

    .reset-btn:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .chat-hints {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      overflow: hidden;
    }

    .chat-hints span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chat-hints i {
      font-style: normal;
      opacity: 0.7;
    }

    .chat-body {
      flex: 1;
      padding: 6px 10px 6px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      scroll-behavior: smooth;
    }

    .chat-body::-webkit-scrollbar {
      width: 4px;
    }
    .chat-body::-webkit-scrollbar-thumb {
      background: #bbf7d0;
      border-radius: 999px;
    }
    .chat-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-footer {
      padding: 8px 10px 12px;
      border-top: 1px solid var(--border-soft);
      background: radial-gradient(circle at top, #ecfdf5 0, #ffffff 55%);
    }

    /* Messages */

    .msg-row {
      display: flex;
      width: 100%;
    }

    .msg-row.user {
      justify-content: flex-start; /* RTL: Ø³Ù…Øª Ø±Ø§Ø³Øª Ú©Ø§Ø±Ø¨Ø±Ù‡ */
    }

    .msg-row.bot {
      justify-content: flex-end;
    }

    .msg-bubble {
      max-width: 82%;
      border-radius: var(--radius-lg);
      padding: 9px 12px;
      font-size: 13px;
      line-height: 1.7;
      position: relative;
      box-shadow: 0 8px 20px rgba(15, 118, 110, 0.07);
    }

    .msg-row.user .msg-bubble {
      background: var(--bubble-user);
      color: #ecfdf3;
      border-bottom-right-radius: 4px;
    }

    .msg-row.bot .msg-bubble {
      background: var(--bubble-bot);
      color: var(--text-main);
      border-bottom-left-radius: 4px;
      border: 1px solid #e5e7eb;
    }

    .msg-meta {
      margin-top: 4px;
      font-size: 10px;
      opacity: 0.7;
      display: flex;
      justify-content: flex-start;
      gap: 4px;
    }

    .msg-row.bot .msg-meta {
      justify-content: flex-end;
    }

    .msg-author {
      font-weight: 500;
    }

    .msg-time {
      font-variant-numeric: tabular-nums;
    }

    .msg-system {
      align-self: center;
      font-size: 11px;
      color: var(--text-muted);
      background: #ecfdf5;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px dashed #bbf7d0;
      margin: 6px auto;
    }

    /* Typing indicator */

    .typing {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .typing-dots {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      margin-right: 4px;
    }

    .typing-dot {
      width: 5px;
      height: 5px;
      border-radius: 999px;
      background: #9ca3af;
      animation: typing 1.2s infinite ease-in-out;
    }

    .typing-dot:nth-child(2) {
      animation-delay: 0.15s;
    }
    .typing-dot:nth-child(3) {
      animation-delay: 0.3s;
    }

    /* Input area */

    .chat-form {
      display: flex;
      align-items: flex-end;
      gap: 8px;
    }

    .input-wrap {
      flex: 1;
      background: #f9fafb;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 5px 10px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
    }

    .input-wrap:focus-within {
      border-color: #34d399;
      box-shadow: 0 0 0 1px #a7f3d0, 0 6px 16px rgba(22, 163, 74, 0.2);
      background: #ffffff;
    }

    .chat-input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      resize: none;
      max-height: 70px;
      min-height: 24px;
      font-size: 13px;
      line-height: 1.6;
      direction: rtl;
    }

    .chat-input::placeholder {
      color: #9ca3af;
    }

    .icon-button {
      border: none;
      background: none;
      cursor: pointer;
      font-size: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px;
      color: #6b7280;
      transition: transform 0.12s, color 0.15s;
    }

    .icon-button:hover {
      transform: translateY(-1px);
      color: #16a34a;
    }

    .send-button {
      border: none;
      border-radius: 999px;
      padding: 9px 15px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ffffff;
      cursor: pointer;
      box-shadow: 0 12px 20px rgba(22, 163, 74, 0.35);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
    }

    .send-button span {
      font-size: 15px;
    }

    .send-button:disabled {
      opacity: 0.65;
      cursor: default;
      box-shadow: 0 6px 12px rgba(15,23,42,0.12);
    }

    .send-button:not(:disabled):hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
    }

    .send-button:not(:disabled):active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(22, 163, 74, 0.22);
    }

    /* Emoji panel */

    .emoji-panel {
      position: absolute;
      bottom: 62px;
      right: 22px;
      background: #ffffff;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 8px;
      display: none;
      align-items: center;
      gap: 4px;
      box-shadow: var(--shadow-chip);
      z-index: 10;
    }

    .emoji-panel button {
      border: none;
      background: #f3f4f6;
      border-radius: 999px;
      padding: 3px 6px;
      cursor: pointer;
      font-size: 16px;
      transition: transform 0.08s, background 0.12s;
    }

    .emoji-panel button:hover {
      background: #e5e7eb;
      transform: translateY(-1px);
    }

    /* Animations */

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.25; }
      30% { transform: translateY(-2px); opacity: 1; }
    }

    /* Small screens */

    @media (max-width: 600px) {
      .app {
        border-radius: 0;
      }
      .chat-card {
        border-radius: 22px 22px 0 0;
      }
      .msg-bubble {
        max-width: 88%;
      }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- Header -->
    <header class="app-header">
      <div class="header-inner">
        <div class="header-main">
          <div class="bot-avatar">
            <!-- Ù„ÙˆÚ¯ÙˆÛŒ Ø·Ø§ÙˆÛŒØªØ§ -->
            <img src="https://cdnfa.com/irangiah/a9be/uploads/new5/picsart-25-11-11-18-20-53-865.png"
                 alt="Tavita Logo"
                 onerror="this.style.display='none'; this.parentElement.innerHTML='<span class=&quot;bot-logo-fallback&quot;>ğŸ¤–</span>';">
          </div>
          <div class="header-texts">
            <div class="header-title-row">
              <span>chatgpt</span>
              <div class="header-badge">
                Ù†Ø³Ø®Ù‡ ÙˆÛŒÚ˜Ù‡ Ø·Ø§ÙˆÛŒØªØ§
              </div>
            </div>
            <div class="header-subtitle">
              <div class="online-dot"></div>
              <span>Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒØªØ§</span>
            </div>
          </div>
        </div>
        <div class="header-actions">
          <div class="hint-pill">
            <span>ğŸ’¡ Ø¨Ù‡ØªØ± Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ù… Ø§Ú¯Ø± Ø¯Ù‚ÛŒÙ‚ Ø¨Ù¾Ø±Ø³ÛŒ</span>
          </div>
          <div class="small-link">
            ğŸŒ¿ Ù…Ø¯Ø±Ø³Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø·Ø§ÙˆÛŒØªØ§
          </div>
        </div>
      </div>
    </header>

    <!-- Chat card -->
    <main class="chat-shell">
      <section class="chat-card">
        <div class="chat-top">
          <div class="chat-hints">
            <span>âœ¨ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯:</span>
            <span><i>Â«ÛŒÚ© Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù† Ø¨Ù†ÙˆÛŒØ³Â»</i></span>
          </div>
          <button class="reset-btn" id="resetChatBtn" type="button">
            ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú†Øª
          </button>
        </div>

        <div class="chat-body" id="chatBody">
          <div class="msg-row bot">
            <div class="msg-bubble">
              <div>Ø³Ù„Ø§Ù… ğŸ‘‹ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…ØŸ</div>
              <div class="msg-meta">
                <span class="msg-author">chatgpt</span>
                <span class="msg-time">Ø§Ù„Ø§Ù†</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chat-footer">
          <form class="chat-form" id="chatForm">
            <div class="input-wrap">
              <button class="icon-button" type="button" id="emojiToggle" aria-label="Ø§ÛŒÙ…ÙˆØ¬ÛŒ">
                ğŸ˜Š
              </button>
              <textarea
                id="userInput"
                class="chat-input"
                rows="1"
                placeholder="Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
              ></textarea>
            </div>
            <button class="send-button" id="sendBtn" type="submit">
              <span>ğŸš€</span>
              <span>Ø§Ø±Ø³Ø§Ù„</span>
            </button>
          </form>

          <div class="emoji-panel" id="emojiPanel">
            <button type="button">ğŸ˜Š</button>
            <button type="button">âœ¨</button>
            <button type="button">ğŸŒ¿</button>
            <button type="button">ğŸ”¥</button>
            <button type="button">â¤ï¸</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const chatBody   = document.getElementById('chatBody');
      const chatForm   = document.getElementById('chatForm');
      const userInput  = document.getElementById('userInput');
      const sendBtn    = document.getElementById('sendBtn');
      const resetBtn   = document.getElementById('resetChatBtn');
      const emojiToggle = document.getElementById('emojiToggle');
      const emojiPanel  = document.getElementById('emojiPanel');

      let isSending = false;

      function nowTime() {
        const d = new Date();
        const hh = String(d.getHours()).padStart(2, '0');
        const mm = String(d.getMinutes()).padStart(2, '0');
        return hh + ':' + mm;
      }

      function scrollToBottom() {
        requestAnimationFrame(() => {
          chatBody.scrollTop = chatBody.scrollHeight;
        });
      }

      function addMessage({ text, from }) {
        const row = document.createElement('div');
        row.className = 'msg-row ' + (from === 'user' ? 'user' : 'bot');

        const bubble = document.createElement('div');
        bubble.className = 'msg-bubble';

        const content = document.createElement('div');
        content.textContent = text;

        const meta = document.createElement('div');
        meta.className = 'msg-meta';

        const author = document.createElement('span');
        author.className = 'msg-author';
        author.textContent = from === 'user' ? 'Ø´Ù…Ø§' : 'chatgpt';

        const time = document.createElement('span');
        time.className = 'msg-time';
        time.textContent = nowTime();

        meta.appendChild(author);
        meta.appendChild(time);

        bubble.appendChild(content);
        bubble.appendChild(meta);
        row.appendChild(bubble);
        chatBody.appendChild(row);
        scrollToBottom();
      }

      function addSystemMessage(text) {
        const div = document.createElement('div');
        div.className = 'msg-system';
        div.textContent = text;
        chatBody.appendChild(div);
        scrollToBottom();
      }

      function showTyping() {
        const row = document.createElement('div');
        row.className = 'msg-row bot';
        row.id = 'typingRow';

        const bubble = document.createElement('div');
        bubble.className = 'msg-bubble';

        bubble.innerHTML = `
          <div class="typing">
            <span class="typing-dots">
              <span class="typing-dot"></span>
              <span class="typing-dot"></span>
              <span class="typing-dot"></span>
            </span>
            Ø¯Ø± Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ†...
          </div>
        `;

        row.appendChild(bubble);
        chatBody.appendChild(row);
        scrollToBottom();
      }

      function hideTyping() {
        const row = document.getElementById('typingRow');
        if (row && row.parentNode) {
          row.parentNode.removeChild(row);
        }
      }

      async function sendMessage(message) {
        if (!message.trim()) return;
        if (isSending) return;

        isSending = true;
        sendBtn.disabled = true;

        addMessage({ text: message, from: 'user' });
        userInput.value = '';
        emojiPanel.style.display = 'none';

        showTyping();

        try {
          const res = await fetch('/api/chat', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message })
          });

          const data = await res.json().catch(() => ({}));
          hideTyping();

          if (!res.ok || !data || data.ok === false || !data.answer) {
            const errMsg =
              (data && data.error) ||
              'âŒ Ø®Ø·Ø§ Ø§Ø² Ø³Ù…Øª Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡Ù” Ø¯ÛŒÚ¯Ø± Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.';
            addMessage({ text: errMsg, from: 'bot' });
          } else {
            addMessage({ text: data.answer, from: 'bot' });
          }
        } catch (err) {
          console.error(err);
          hideTyping();
          addMessage({
            text: 'âŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø±Ø® Ø¯Ø§Ø¯. Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª ÛŒØ§ ÙÛŒÙ„ØªØ±Ø´Ú©Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.',
            from: 'bot'
          });
        } finally {
          isSending = false;
          sendBtn.disabled = false;
          userInput.focus();
        }
      }

      chatForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const msg = userInput.value.trim();
        if (!msg) return;
        sendMessage(msg);
      });

      userInput.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          const msg = userInput.value.trim();
          if (!msg) return;
          sendMessage(msg);
        }
      });

      resetBtn.addEventListener('click', function () {
        chatBody.innerHTML = '';
        addSystemMessage('Ú†Øª Ù¾Ø§Ú© Ø´Ø¯. Ù‡Ø± Ø³Ø¤Ø§Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù¾Ø±Ø³ ğŸŒ¿');
      });

      emojiToggle.addEventListener('click', function () {
        emojiPanel.style.display =
          emojiPanel.style.display === 'flex' ? 'none' : 'flex';
      });

      emojiPanel.addEventListener('click', function (e) {
        if (e.target.tagName === 'BUTTON') {
          const emoji = e.target.textContent;
          userInput.value += (userInput.value ? ' ' : '') + emoji;
          userInput.focus();
        }
      });

      document.addEventListener('click', function (e) {
        if (
          !emojiPanel.contains(e.target) &&
          !emojiToggle.contains(e.target)
        ) {
          emojiPanel.style.display = 'none';
        }
      });
    })();
  </script>
</body>
</html>
