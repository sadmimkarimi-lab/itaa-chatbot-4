<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <title>Ø±Ø¨Ø§Øª chatgpt - Ù†Ø³Ø®Ù‡ ÙˆÛŒÚ˜Ù‡ Ø·Ø§ÙˆÛŒØªØ§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap"
    />

    <style>
      :root {
        --green-50: #f0fdf4;
        --green-100: #dcfce7;
        --green-200: #bbf7d0;
        --green-400: #4ade80;
        --green-500: #22c55e;
        --green-600: #16a34a;
        --green-700: #15803d;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-700: #374151;
        --gray-900: #111827;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: "Vazirmatn", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: #f5f9f6;
        color: var(--gray-900);
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
      }

      .app {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: linear-gradient(180deg, #ecfdf3 0%, #f9fafb 40%, #ffffff 100%);
      }

      /* ===== Ù‡Ø¯Ø± Ø³Ø¨Ø² Ø·Ø§ÙˆÛŒØªØ§ ===== */
      .app-header {
        border-radius: 0 0 22px 22px;
        padding: 14px 16px 18px;
        background: radial-gradient(
          circle at top,
          #22c55e 0%,
          #16a34a 45%,
          #15803d 100%
        );
        box-shadow: 0 10px 30px rgba(16, 185, 129, 0.35);
        color: #fff;
      }

      .app-header-main {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .app-header-title {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .app-header-name {
        font-size: 20px;
        font-weight: 700;
        letter-spacing: 0.3px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .app-header-name span.emoji {
        font-size: 20px;
      }

      .app-header-subtitle {
        font-size: 12px;
        color: rgba(240, 253, 250, 0.9);
      }

      .app-header-badges {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .header-chip {
        font-size: 11px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(240, 253, 244, 0.2);
        color: #ecfdf3;
        border: 1px solid rgba(187, 247, 208, 0.5);
        backdrop-filter: blur(8px);
        white-space: nowrap;
      }

      .app-header-avatar {
        width: 46px;
        height: 46px;
        border-radius: 999px;
        border: 2px solid rgba(240, 253, 244, 0.9);
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.25);
        overflow: hidden;
        flex-shrink: 0;
      }

      .app-header-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      /* Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø§Ù„Ø§ÛŒ Ú†Øª */
      .app-tip-bar {
        padding: 10px 16px 0;
      }

      .tip-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(187, 247, 208, 0.25);
        color: #14532d;
        font-size: 11px;
        border: 1px solid rgba(74, 222, 128, 0.6);
      }

      .tip-pill span.icon {
        font-size: 14px;
      }

      /* ===== Ù…Ø­ØªÙˆØ§ÛŒ Ú†Øª ===== */
      .chat-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 8px 12px 12px;
      }

      .chat-card {
        flex: 1;
        background: #ffffff;
        border-radius: 18px;
        padding: 10px 10px 4px;
        box-shadow: 0 8px 26px rgba(148, 163, 184, 0.35);
        display: flex;
        flex-direction: column;
        max-width: 720px;
        margin: 0 auto;
      }

      .chat-header-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 6px;
      }

      .chat-clear-btn {
        border: none;
        background: transparent;
        font-size: 12px;
        color: #16a34a;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        padding: 0;
      }

      .chat-clear-btn span.icon {
        font-size: 16px;
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 4px 2px 8px;
        scrollbar-width: thin;
        scrollbar-color: rgba(148, 163, 184, 0.6) transparent;
      }

      .chat-messages::-webkit-scrollbar {
        width: 6px;
      }

      .chat-messages::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.6);
        border-radius: 999px;
      }

      .message-row {
        display: flex;
        margin-bottom: 8px;
      }

      .message-row.user {
        justify-content: flex-start;
      }

      .message-row.bot {
        justify-content: flex-end;
      }

      .message-bubble {
        max-width: 78%;
        padding: 10px 12px;
        border-radius: 16px;
        font-size: 13px;
        line-height: 1.7;
        position: relative;
        word-wrap: break-word;
        white-space: pre-wrap;
      }

      .message-bubble.user {
        background: #16a34a;
        color: #ecfdf5;
        border-bottom-right-radius: 4px;
        box-shadow: 0 6px 18px rgba(22, 163, 74, 0.35);
      }

      .message-bubble.bot {
        background: var(--gray-50);
        color: var(--gray-900);
        border-bottom-left-radius: 4px;
        box-shadow: 0 6px 18px rgba(148, 163, 184, 0.25);
      }

      .message-meta {
        font-size: 10px;
        margin-top: 2px;
        opacity: 0.65;
        text-align: left;
      }

      .message-meta span.label {
        margin-right: 4px;
      }

      .message-bubble.bot .message-meta {
        text-align: left;
      }

      .message-bubble.user .message-meta {
        text-align: right;
      }

      .system-message {
        text-align: center;
        font-size: 11px;
        color: #6b7280;
        margin: 10px 0;
      }

      /* ===== ÙˆØ±ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± ===== */
      .input-area {
        padding-top: 8px;
        border-top: 1px solid rgba(209, 213, 219, 0.7);
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 4px;
      }

      .input-box {
        flex: 1;
        position: relative;
      }

      .input-box input {
        width: 100%;
        border-radius: 999px;
        border: 1px solid var(--green-200);
        padding: 10px 38px 10px 14px;
        font-family: inherit;
        font-size: 13px;
        outline: none;
        background: var(--green-50);
        color: var(--gray-900);
      }

      .input-box input::placeholder {
        color: #9ca3af;
      }

      .input-emoji {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        opacity: 0.9;
        pointer-events: none;
      }

      .send-btn {
        border: none;
        border-radius: 999px;
        background: #16a34a;
        color: #ecfdf5;
        padding: 10px 16px;
        font-size: 13px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        font-family: inherit;
        box-shadow: 0 6px 18px rgba(22, 163, 74, 0.4);
        white-space: nowrap;
      }

      .send-btn:disabled {
        opacity: 0.6;
        cursor: default;
        box-shadow: none;
      }

      .send-btn span.icon {
        font-size: 16px;
      }

      @media (max-width: 480px) {
        .chat-card {
          border-radius: 16px 16px 0 0;
          box-shadow: 0 -2px 20px rgba(148, 163, 184, 0.35);
        }

        .message-bubble {
          max-width: 86%;
        }

        .app-header-name {
          font-size: 18px;
        }
      }
    </style>
  </head>

  <body>
    <div class="app">
      <!-- Ù‡Ø¯Ø± Ø¨Ø§Ù„Ø§ -->
      <header class="app-header">
        <div class="app-header-main">
          <div class="app-header-title">
            <div class="app-header-name">
              <span class="emoji">ğŸ¤–</span>
              <span>chatgpt</span>
            </div>
            <div class="app-header-subtitle">
              Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒØªØ§ â€¢ Ù†Ø³Ø®Ù‡ ÙˆÛŒÚ˜Ù‡ Ù…Ø¯Ø±Ø³Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø·Ø§ÙˆÛŒØªØ§ ğŸŒ¿
            </div>
            <div class="app-header-badges">
              <div class="header-chip">Ø¨Ù‡ØªØ±ÛŒÙ† Ù†ØªÛŒØ¬Ù‡ Ø¨Ø§ ÙØ§Ø±Ø³ÛŒ Ø±ÙˆØ§Ù† âœ¨</div>
              <div class="header-chip">Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø¸Ù… Ùˆ ØªÙ…ÛŒØ² ğŸ§¼</div>
              <div class="header-chip">Ù…Ù†Ø§Ø³Ø¨ Ù†Ú¯Ø§Ø±Ø´ØŒ Ø¯Ø±Ø³ Ùˆ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± ğŸ“š</div>
            </div>
          </div>
          <div class="app-header-avatar">
            <img
              src="https://cdnfa.com/irangiah/a9be/uploads/new5/picsart-25-11-11-18-20-53-865.png"
              alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø·Ø§ÙˆÛŒØªØ§"
            />
          </div>
        </div>
      </header>

      <!-- Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ -->
      <div class="app-tip-bar">
        <div class="tip-pill">
          <span class="icon">âœ¨</span>
          <span>Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Â«ÛŒÚ© Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù† Ø¨Ù†ÙˆÛŒØ³Â» âœï¸</span>
        </div>
      </div>

      <!-- Ø¨Ø¯Ù†Ù‡â€ŒÛŒ Ú†Øª -->
      <main class="chat-wrapper">
        <section class="chat-card">
          <div class="chat-header-row">
            <button id="clear-btn" class="chat-clear-btn" type="button">
              <span class="icon">ğŸ§¹</span>
              <span>Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú†Øª</span>
            </button>
          </div>

          <div id="chat-messages" class="chat-messages"></div>

          <div class="input-area">
            <div class="input-box">
              <input
                id="user-input"
                type="text"
                autocomplete="off"
                placeholder="ğŸ˜Š Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³..."
              />
              <div class="input-emoji">ğŸ’¬</div>
            </div>
            <button id="send-btn" class="send-btn" type="button">
              <span>Ø§Ø±Ø³Ø§Ù„</span>
              <span class="icon">ğŸš€</span>
            </button>
          </div>
        </section>
      </main>
    </div>

    <script>
      const chatEl = document.getElementById("chat-messages");
      const inputEl = document.getElementById("user-input");
      const sendBtn = document.getElementById("send-btn");
      const clearBtn = document.getElementById("clear-btn");

      function scrollToBottom() {
        chatEl.scrollTop = chatEl.scrollHeight;
      }

      function addMessage(text, sender = "bot") {
        const row = document.createElement("div");
        row.className = `message-row ${sender}`;

        const bubble = document.createElement("div");
        bubble.className = `message-bubble ${sender}`;
        bubble.textContent = text;

        const meta = document.createElement("div");
        meta.className = "message-meta";

        const now = new Date();
        const timeStr = now.toLocaleTimeString("fa-IR", {
          hour: "2-digit",
          minute: "2-digit",
        });

        const labelSpan = document.createElement("span");
        labelSpan.className = "label";
        labelSpan.textContent = sender === "user" ? "Ø´Ù…Ø§" : "chatgpt";

        const timeSpan = document.createElement("span");
        timeSpan.textContent = timeStr;

        meta.appendChild(timeSpan);
        meta.appendChild(document.createTextNode(" â€¢ "));
        meta.appendChild(labelSpan);

        bubble.appendChild(meta);
        row.appendChild(bubble);
        chatEl.appendChild(row);
        scrollToBottom();
      }

      function addSystemMessage(text) {
        const div = document.createElement("div");
        div.className = "system-message";
        div.textContent = text;
        chatEl.appendChild(div);
        scrollToBottom();
      }

      async function sendMessage() {
        const text = (inputEl.value || "").trim();
        if (!text) return;

        addMessage(text, "user");
        inputEl.value = "";
        inputEl.focus();

        sendBtn.disabled = true;

        let thinkingId = null;
        thinkingId = setTimeout(() => {
          addSystemMessage("Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù† Ù‡Ø³ØªÙ…ØŒ Ú†Ù†Ø¯ Ù„Ø­Ø¸Ù‡ ØµØ¨Ø± Ú©Ù† ğŸ¤”");
        }, 800);

        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: text }),
          });

          let data = {};
          try {
            data = await res.json();
          } catch (_) {}

          if (!res.ok) {
            throw new Error("response not ok");
          }

          const reply =
            data.reply ||
            data.message ||
            data.answer ||
            (data.choices &&
              data.choices[0] &&
              data.choices[0].message &&
              data.choices[0].message.content) ||
            null;

          if (reply) {
            addMessage(String(reply), "bot");
          } else {
            addMessage(
              "Ù¾Ø§Ø³Ø®ÛŒ Ø§Ø² Ø³Ø±ÙˆØ± Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯ ğŸŒ± Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†.",
              "bot"
            );
          }
        } catch (err) {
          addMessage(
            "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±. Ø§Ú¯Ø± VPN ÛŒØ§ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù…Ø´Ú©Ù„ Ø¯Ø§Ø±Ø¯ØŒ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†.",
            "bot"
          );
        } finally {
          clearTimeout(thinkingId);
          sendBtn.disabled = false;
          scrollToBottom();
        }
      }

      function clearChat() {
        chatEl.innerHTML = "";
        addMessage("Ú†Øª Ù¾Ø§Ú© Ø´Ø¯ ğŸŒ¿ Ù‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù¾Ø±Ø³ ğŸ’š", "bot");
      }

      // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
      sendBtn.addEventListener("click", sendMessage);
      inputEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          sendMessage();
        }
      });
      clearBtn.addEventListener("click", clearChat);

      // Ù¾ÛŒØ§Ù… Ø®ÙˆØ´Ø§Ù…Ø¯ Ø§ÙˆÙ„ÛŒÙ‡
      addMessage(
        "Ø³Ù„Ø§Ù… ğŸ‘‹ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ âœ¨ Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…ØŸ",
        "bot"
      );
    </script>
  </body>
</html>
