<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <title>Ø±Ø¨Ø§Øª chatgpt Ø§ÛŒØªØ§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ -->
    <link
      href="https://cdn.jsdelivr.net/gh/rastikerdar/shabnam-font/dist/font-face.css"
      rel="stylesheet"
    />

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background: #f3f7f4;
        font-family: "Shabnam", sans-serif;
      }

      .app {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* ğŸ¨ Ù‡Ø¯Ø± Ø³Ø¨Ø² */
      .app-header {
        background: linear-gradient(135deg, #0f9d58, #12b565);
        color: #ffffff;
        padding: 14px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.25);
      }

      .app-header-avatar {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        color: #0f9d58;
      }

      .app-header-title {
        font-size: 18px;
        font-weight: 700;
      }

      .app-header-subtitle {
        font-size: 13px;
        opacity: 0.9;
      }

      /* Ø¨Ø¯Ù†Ù‡ Ú†Øª */
      .chat-wrapper {
        flex: 1;
        display: flex;
        justify-content: center;
        padding: 10px;
      }

      .chat-container {
        width: 100%;
        max-width: 720px;
        background: rgba(255, 255, 255, 0.85);
        border-radius: 18px 18px 0 0;
        display: flex;
        flex-direction: column;
      }

      .chat-messages {
        padding: 16px 14px 8px;
        overflow-y: auto;
        flex: 1;
      }

      .message-row {
        display: flex;
        margin-bottom: 10px;
      }

      .message-row.bot {
        justify-content: flex-start;
      }

      .message-row.user {
        justify-content: flex-end;
      }

      .message-bubble {
        max-width: 80%;
        padding: 10px 14px;
        border-radius: 18px;
        font-size: 15px;
        line-height: 1.9;
        white-space: pre-wrap;
      }

      /* â˜˜ï¸ Ø­Ø¨Ø§Ø¨ Ø±Ø¨Ø§Øª */
      .message-bubble.bot {
        background: #ffffff;
        color: #1a1a1a;
        border: 1px solid #e0f2e9;
        box-shadow: 0 4px 12px rgba(15, 157, 88, 0.1);
        border-radius: 18px 18px 18px 4px;
      }

      /* ğŸ’š Ø­Ø¨Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø± */
      .message-bubble.user {
        background: #0f9d58;
        color: white;
        border-radius: 18px 18px 4px 18px;
        box-shadow: 0 4px 12px rgba(15, 157, 88, 0.4);
      }

      .message-meta {
        margin-top: 4px;
        font-size: 11px;
        opacity: 0.65;
      }

      /* ØªØ§ÛŒÙ¾ÛŒÙ†Ú¯ */
      .typing {
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .typing-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #7ebd9b;
        animation: bounce 1s infinite ease-in-out;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          opacity: 0.4;
          transform: translateY(0);
        }
        40% {
          opacity: 1;
          transform: translateY(-4px);
        }
      }

      /* ÙˆØ±ÙˆØ¯ÛŒ */
      .chat-input-wrapper {
        border-top: 1px solid #dceee3;
        background: #ffffff;
        padding: 8px 12px;
      }

      .chat-input-inner {
        max-width: 720px;
        margin: 0 auto;
        display: flex;
        gap: 8px;
      }

      .chat-textarea {
        flex: 1;
        border-radius: 16px;
        border: 1px solid #b8dec9;
        padding: 10px 12px;
        font-size: 14px;
        resize: none;
        min-height: 40px;
        background: #f5fbf7;
      }

      .chat-textarea:focus {
        border-color: #0f9d58;
        box-shadow: 0 0 0 2px rgba(15, 157, 88, 0.2);
        background: #ffffff;
        outline: none;
      }

      .send-button {
        background: #0f9d58;
        color: #ffffff;
        border: none;
        border-radius: 14px;
        padding: 0 18px;
        height: 40px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 3px 8px rgba(15, 157, 88, 0.3);
        transition: 0.15s;
      }

      .send-button:active {
        transform: scale(0.95);
      }

      /* Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ú†Øª */
      .top-actions {
        text-align: left;
        padding: 8px 16px;
      }

      .clear-button {
        background: transparent;
        border: none;
        color: #0f9d58;
        font-size: 12px;
        cursor: pointer;
      }

      .clear-button:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="app">
      <!-- Ù‡Ø¯Ø± Ø³Ø¨Ø² -->
      <header class="app-header">
        <div class="app-header-avatar">ğŸ¤–</div>
        <div>
          <div class="app-header-title">chatgpt</div>
          <div class="app-header-subtitle">Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒØªØ§</div>
        </div>
      </header>

      <div class="chat-wrapper">
        <div class="chat-container">
          <div class="top-actions">
            <button id="clearChat" class="clear-button">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú†Øª</button>
          </div>

          <div id="chatMessages" class="chat-messages"></div>

          <!-- ÙˆØ±ÙˆØ¯ÛŒ -->
          <div class="chat-input-wrapper">
            <form id="chatForm" class="chat-input-inner">
              <textarea
                id="userInput"
                class="chat-textarea"
                placeholder="Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
              ></textarea>
              <button type="submit" id="sendBtn" class="send-button">
                Ø§Ø±Ø³Ø§Ù„ ğŸš€
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      const chatMessages = document.getElementById("chatMessages");
      const chatForm = document.getElementById("chatForm");
      const userInput = document.getElementById("userInput");
      const sendBtn = document.getElementById("sendBtn");
      const clearBtn = document.getElementById("clearChat");

      addBotMessage("Ø³Ù„Ø§Ù… ğŸ‘‹ Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…ØŸ");

      clearBtn.addEventListener("click", () => {
        chatMessages.innerHTML = "";
        addBotMessage("Ú†Øª Ù¾Ø§Ú© Ø´Ø¯. Ù‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ù¾Ø±Ø³ ğŸŒ¿");
      });

      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const text = userInput.value.trim();
        if (!text) return;

        addUserMessage(text);
        userInput.value = "";

        const typingId = showTyping();

        sendBtn.disabled = true;

        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: text }),
          });

          const data = await res.json().catch(() => ({}));

          hideTyping(typingId);

          if (!res.ok) {
            addBotMessage("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†.");
            return;
          }

          addBotMessage(data.reply || data.message || "Ù¾Ø§Ø³Ø®ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯.");
        } catch (e) {
          hideTyping(typingId);
          addBotMessage("âŒ Ù…Ø´Ú©Ù„ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡. Ø§ÛŒÙ†ØªØ±Ù†Øª ÛŒØ§ VPN Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†.");
        }

        sendBtn.disabled = false;
      });

      function addUserMessage(text) {
        const row = document.createElement("div");
        row.className = "message-row user";

        const bubble = document.createElement("div");
        bubble.className = "message-bubble user";
        bubble.textContent = text;

        row.appendChild(bubble);
        chatMessages.appendChild(row);
        scrollToEnd();
      }

      function addBotMessage(text) {
        const row = document.createElement("div");
        row.className = "message-row bot";

        const bubble = document.createElement("div");
        bubble.className = "message-bubble bot";

        const content = document.createElement("div");
        content.textContent = text;

        const meta = document.createElement("div");
        meta.className = "message-meta";
        meta.textContent = "chatgpt";

        bubble.appendChild(content);
        bubble.appendChild(meta);
        row.appendChild(bubble);
        chatMessages.appendChild(row);

        scrollToEnd();
      }

      function showTyping() {
        const id = "typing-" + Date.now();
        const row = document.createElement("div");
        row.className = "message-row bot";
        row.id = id;

        const bubble = document.createElement("div");
        bubble.className = "message-bubble bot typing";

        for (let i = 0; i < 3; i++) {
          const dot = document.createElement("span");
          dot.className = "typing-dot";
          bubble.appendChild(dot);
        }

        row.appendChild(bubble);
        chatMessages.appendChild(row);
        scrollToEnd();
        return id;
      }

      function hideTyping(id) {
        const item = document.getElementById(id);
        if (item) item.remove();
      }

      function scrollToEnd() {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    </script>
  </body>
</html>
